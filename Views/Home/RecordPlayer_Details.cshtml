@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model MuseMusic.Models.ViewModels.RecordPlayerViewModel
<main>

    <!-- Record Player Head -->
    <section class="section-padding">
        <div class="container">
            <div class="row align-items-center">

                <div class="col-lg-6 col-12">
                    <div class="record-thumb">
                        <input type="hidden" id="prodid" value="@Model.SelectedProduct.ProductId" />
                        <button id="prev" class="btn btn-link"><i class="fa-sharp fa-solid fa-arrow-left"></i></button>
                        <img id="main-image" src="@Model.SelectedProduct.PrimaryImageUrl" class="product-image"
                            alt="Main Product Image">
                        <button id="next" class="btn btn-link"><i class="fa-sharp fa-solid fa-arrow-right"></i></button>
                    </div>

                    <div class="record-secondthumb">
                        <div class="thumbnail-slider">
                            @foreach (var imageUrl in Model.SelectedProduct.ImageUrls)
                            {
                                <div class="thumbnail" data-image="@imageUrl">
                                    <img src="@imageUrl" alt="Product Thumbnail">
                                </div>
                            }
                        </div>
                    </div>

                </div>

                <div class="col-lg-6 col-12">

                    <!-- Record Player Price & Info -->
                    <div class="record-info">
                        <div>
                            <h2 id="prodname">@Model.SelectedProduct.ProductName</h2>

                            <h3>@Model.SelectedProduct.SelectedBrandName</h3>

                            <h4 id="prodprice">@Model.SelectedProduct.Price.ToString("N0") ₫</h4>

                            <h5>Mã sản phẩm: @Model.SelectedProduct.ProductId</h5>

                            <h6>Sản phẩm gợi ý:</h6>
                        </div>
                    </div>
                    <!-- Record Player Recommendation -->

                    <div class="row">
                        @foreach (var product in Model.Products)
                        {
                            <div class="col-lg-6 col-12 mt-4 mt-lg-0">
                                <div class="record-recommend">
                                    <h7>@product.ProductName</h7>
                                    <h8>@product.SelectedBrandName</h8>
                                    <h9>@product.Price.ToString("N0") ₫</h9>
                                </div>
                            </div>
                        }
                    </div>

                    <!-- Record Player Add to cart -->
                    <div class="record-cart-thumb">

                        <div class="row">
                            <div class="col-lg-4 col-12">

                                <div class="align-items-center">
                                    <div class="quantity">
                                        <button class="btn btn-link px-2"
                                            onclick="this.parentNode.querySelector('input[type=number]').stepDown()">
                                            <i class="icofont-minus-square"></i>
                                        </button>

                                        <input id="quantity-selection" min="1" name="quantity" value="1" type="number"
                                            class="form-control form-control-sm" style="width: 50px;" />

                                        <button class="btn btn-link px-2"
                                            onclick="this.parentNode.querySelector('input[type=number]').stepUp()">
                                            <i class="icofont-plus-square"></i>
                                        </button>
                                    </div>
                                </div>

                            </div>

                            <div class="col-lg-8 col-12">
                                <a href=""><button id="addcart" class="cart-btn">Thêm vào giỏ hàng</button></a>
                            </div>

                        </div>

                    </div>

                    <!-- Record Player Information -->
                    <div class="record-underinfo">
                        <h5>Thông tin sản phẩm:</h5>
                        <div class="row">
                            <div class="col-lg-4 col-12">
                                <p>Motor</p>
                                <p>Tốc độ</p>
                                <p>Tình trạng</p>
                            </div>

                            <div class="col-lg-8 col-12">
                                <p>Dây Curoa (Belt-Drive)</p>
                                <p>33 1/3, 45</p>
                                <p>PREORDER</p>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Record Player Warning -->
    <section class="section-padding">
        <div class="container">
            <div class="player-warn">
                <h4>LƯU Ý KHI MUA HÀNG</h4>
                <h5>Vui lòng chuyển khoản 100% đơn hàng có <span>sản phẩm PRE-ORDER.</span></h5>
                <h5>Giá sản phẩm <span>PRE-ORDER</span> cập nhật hàng tuần, Vọc Records sẽ liên hệ nếu có chênh lệch.
                </h5>
                <h5>Thời gian vận chuyển: Sản phẩm <span>CÒN HÀNG 1-5 ngày</span>, sản phẩm <span>PREORDER 2-4
                        tuần.</span></h5>
                <h5>KHÔNG <span>HUỶ/ HOÀN TIỀN</span> sản phẩm <span>PRE-ORDER</span>.</h5>
            </div>
        </div>
    </section>

    <!-- Record Player Description -->
    <section class="section-padding">
        <div class="container">
            <div class="row align-items-center">

                <div class="col-lg-12 col-12">

                    <div class="record-description">
                        <h2>MÔ TẢ SẢN PHẨM</h2>
                        <p>Sản phẩm đến từ thương hiệu đồ âm thanh nổi tiếng Audio Technica xuất sứ Nhật Bản, nhập khẩu
                            chính hãng từ Hoa Kỳ. Phiên bản USB cho phép bạn có thể convert âm thanh từ đĩa than thành
                            file digital trên máy tính thông qua cổng USB trên mâm</p>
                        <p>Máy đĩa than AT-LP60XUSB là một trong những mâm đĩa than tốt nhất trong tầm giá rẻ, đặc biệt
                            phù hợp với người bắt đầu chơi hoặc không quá cầu kì về thiết bị phát.</p>
                        <p>Với thiết kế sang trọng, hiện đại, được tích hợp nhiều công nghệ và chạy được cả tốc độ 33
                            1/3 và 45 RPM, LP60XUSB đi kèm các nút bấm tự động đặt kim, nhả kim và dừng hoạt động. Đặc
                            biệt, với cổng phono preamp, mâm có thể kết nối trực tiếp với loa để phát nhạc.</p>
                        <p>Mâm AT-LP60XUSB được thiết kế chạy cơ chế dùng dây curoa dẫn động (belt-drive) truyền lực từ
                            motor DC servo tự hiệu chỉnh tốc độ chính xác, có độ bền cao và dễ dàng sửa chữa thay thế.
                            Tay cần được thiết kế thẳng, dính liền với thân mâm và đã được cân chỉnh sẵn. Đầu kim sử
                            dụng kim MM đến từ chính Audio Technica cho phép thay thế nếu cần thiết.</p>
                        <p>Mâm có thiết kế không quá hiện đại cũng không quá retro, khiến cho nó phù hợp với bất kể
                            không gian nào từ quán cà phê cho đến gian phòng riêng của gia đình. Mâm có thân máy chắc
                            chắn, sức nặng vừa phải, phiến platter làm từ nhôm đúc giữ cho đĩa ổn định khi chạy rất tốt.
                            Các nút bấm được đặt ở phía trước mâm với phong cách tối giản, dễ hiểu. Mâm đi kèm vài sự
                            lựa chọn về màu sắc như đen, đỏ, xám,…</p>
                    </div>
                </div>
            </div>
    </section>

    <!-- More Similar Product -->
    <div class="container">
        <div class="section-title">
            <h1>SẢN PHẨM TƯƠNG TỰ</h1>
        </div>
    </div>

    <!--  Record Player List -->

    <div class="record-container">
        @foreach (var product in Model.Products)
        {
            <div class="record-player">
                <a href="@Url.Action("RecordDetails", "RecordPlayerView", new { id = product.ProductId })">
                    <img src="@product.PrimaryImageUrl" alt="@product.ProductName">
                </a>
                <h2>@product.ProductName</h2>
                <p>@product.SelectedBrandName</p>
                <p class="price">@product.Price.ToString("N0") ₫</p>
                <div class="buttons">
                    <span class="preorder">PREORDER</span>
                </div>
            </div>
        }
    </div>
</main>
<script>
    // Hàm thêm sản phẩm vào giỏ hàng
    function addToCart(item) {
        // Lấy giỏ hàng từ localStorage, nếu không có thì tạo một giỏ hàng rỗng
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        // Kiểm tra xem sản phẩm đã có trong giỏ hàng chưa
        const existingItemIndex = cart.findIndex(cartItem => cartItem.id === item.id);

        if (existingItemIndex === -1) {
            // Nếu sản phẩm chưa có trong giỏ hàng, thêm vào giỏ hàng
            cart.push(item);
            // Lưu lại giỏ hàng vào localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            return true;
        } else {
            // Nếu sản phẩm đã có, trả về false
            return false;
        }
    }

    // Add event listener to the button
    document.getElementById('addcart').addEventListener('click', async function (event) {
        // Ngăn chặn hành động mặc định của nút (để tránh refresh trang)
        event.preventDefault();

        // Vô hiệu hóa nút để ngừng click thêm
        const addButton = event.target;
        addButton.disabled = true;

        const id = document.getElementById('prodid').value;
        const name = document.getElementById('prodname').textContent;
        const price = parseFloat(document.getElementById('prodprice').textContent);
        const quantity = document.getElementById('quantity-selection').value;
        const imageUrl = document.getElementById('main-image').getAttribute('src');

        const item = {
            id: id,
            name: name,
            price: price,
            quantity: quantity,
            image: imageUrl,
        };

        // Kiểm tra và thêm sản phẩm vào giỏ hàng
        const isAdded = addToCart(item);

        if (isAdded) {
            // Hiển thị thông báo nếu sản phẩm được thêm vào giỏ hàng
            await Swal.fire({
                icon: 'success',
                title: 'Thành công',
                text: 'Sản phẩm đã được thêm vào giỏ hàng!',
                timer: 2000,  // Thông báo tồn tại trong 2 giây
                willClose: () => {
                    // Kích hoạt lại nút sau khi thông báo đóng
                    addButton.disabled = false;
                }
            });
        } else {
            // Hiển thị thông báo nếu sản phẩm đã có trong giỏ hàng
            await Swal.fire({
                icon: 'info',
                title: 'Sản phẩm đã có trong giỏ hàng!',
                text: 'Bạn đã thêm sản phẩm này vào giỏ hàng trước đó.',
                timer: 2000,  // Thông báo tồn tại trong 2 giây
                willClose: () => {
                    // Kích hoạt lại nút sau khi thông báo đóng
                    addButton.disabled = false;
                }
            });
        }
    });
</script>
